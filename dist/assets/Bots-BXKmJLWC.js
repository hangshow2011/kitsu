import{n as o,l as r,A as l,w as n,x as d,y as c,q as p,z as m,B as u,G as h,H as f,I as v,J as g,K as _,m as b,a as x}from"./index-Djh35xFL.js";import{E as k,a as C,P as w}from"./PeopleList-BGckBE-O.js";import"./DepartmentNamesCell-ZJxbedBQ.js";import"./PeopleNameCell-DdD0Nxh7.js";const T={name:"new-token-modal",mixins:[r],components:{AlertTriangleIcon:l,DateField:n,EyeIcon:d,EyeOffIcon:c,TextField:p},props:{active:{type:Boolean,default:!1},person:{type:Object,default:()=>{}}},data(){return{form:{expiration_date:null},message:null,visible:!1}},computed:{isValidExpirationDate(){return!this.form.expiration_date||new Date(this.form.expiration_date)>new Date}},methods:{generateToken(){this.$emit("generate-token",{id:this.person.id,expiration_date:this.form.expiration_date})},async copyClicked(){this.message=null,await navigator.clipboard.writeText(this.person.access_token),this.message=this.$t("bots.token_copied"),setTimeout(()=>{this.message=null},5e3)},resetForm(){this.form={expiration_date:this.person.expiration_date},this.message=null,this.visible=!1}},watch:{active(){this.active&&this.resetForm()}}};var $=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal",class:{"is-active":e.active}},[t("div",{staticClass:"modal-background"}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("bots.new_token_title",{name:e.person.full_name}))+" ")]),e.person.access_token?[t("p",{staticClass:"mb2 strong"},[t("alert-triangle-icon",{staticClass:"icon mr05 warning"}),e._v(e._s(e.$t("bots.copy_token_warning"))+" ")],1),t("div",{staticClass:"token"},[t("text-field",{ref:"token",attrs:{disabled:!e.visible,"input-class":" token-input",readonly:!0,type:e.visible?"text":"password",value:e.person.access_token}}),e.visible?t("eye-off-icon",{staticClass:"icon",on:{click:function(a){e.visible=!1}}}):t("eye-icon",{staticClass:"icon",on:{click:function(a){e.visible=!0}}})],1),t("div",{staticClass:"flexrow right"},[t("Transition",{attrs:{name:"fade"}},[e.message?t("p",{staticClass:"success has-text-right mr05"},[e._v(" "+e._s(e.message)+" ")]):e._e()]),t("button",{staticClass:"button flexrow-item is-primary",attrs:{disabled:!e.person.access_token},on:{click:e.copyClicked}},[e._v(" "+e._s(e.$t("main.copy"))+" ")]),t("button",{staticClass:"button flexrow-item is-link",on:{click:function(a){return e.$emit("close")}}},[e._v(" "+e._s(e.$t("main.close"))+" ")])],1)]:t("form",{staticClass:"form",on:{submit:function(a){a.preventDefault()}}},[t("p",{staticClass:"mb2"},[t("alert-triangle-icon",{staticClass:"icon mr05 warning"}),e._v(e._s(e.$t("bots.new_token_warning"))+" ")],1),t("date-field",{attrs:{"disabled-dates":{to:new Date},invalid:!e.isValidExpirationDate,label:e.$t("bots.fields.expiration_date")},model:{value:e.form.expiration_date,callback:function(a){e.$set(e.form,"expiration_date",a)},expression:"form.expiration_date"}}),t("div",{staticClass:"flexrow right"},[t("button",{staticClass:"button flexrow-item is-primary",attrs:{disabled:!e.isValidExpirationDate},on:{click:e.generateToken}},[e._v(" "+e._s(e.$t("bots.generate"))+" ")]),t("button",{staticClass:"button flexrow-item is-link",on:{click:function(a){return e.$emit("cancel")}}},[e._v(" "+e._s(e.$t("main.cancel"))+" ")])])],1)],2)])])},P=[],y=o(T,$,P,!1,null,"c455f8b3",null,null);const D=y.exports,E={name:"bots",mixins:[m],components:{ButtonSimple:u,ComboboxDepartment:h,ComboboxStyled:f,EditAvatarModal:k,EditPersonModal:C,HardDeleteModal:v,NewTokenModal:D,PageTitle:g,PeopleList:w,SearchField:_},data(){return{role:"all",roleOptions:[{label:"all",value:"all"},{label:"admin",value:"admin"},{label:"client",value:"client"},{label:"manager",value:"manager"},{label:"supervisor",value:"supervisor"},{label:"user",value:"user"},{label:"vendor",value:"vendor"}],errors:{avatar:!1,del:!1,edit:!1,userLimit:!1},loading:{del:!1,deletingAvatar:!1,edit:!1,updatingAvatar:!1},modals:{avatar:!1,del:!1,edit:!1,newToken:!1},personToDelete:{},personToEdit:{role:"user"},selectedDepartment:""}},mounted(){this.role=this.$route.query.role||"all",this.selectedDepartment=this.$route.query.department||"",this.loadPeople(()=>{this.setSearchFromUrl(),this.onSearchChange()})},watch:{"modals.edit"(){this.modals.edit&&(this.errors.edit=!1,this.errors.userLimit=!1,this.loading.edit=!1)},selectedDepartment(){this.updateRoute()},role(){this.updateRoute()}},computed:{...b(["displayedPeople","isCurrentUserAdmin","isPeopleLoading","isPeopleLoadingError"]),currentPeople(){let s=this.displayedPeople.filter(e=>e.is_bot);return this.role!=="all"&&(s=s.filter(e=>e.role===this.role)),this.selectedDepartment&&(s=s.filter(e=>e.departments.includes(this.selectedDepartment))),s},deleteText(){var e;const s=(e=this.personToDelete)==null?void 0:e.full_name;return s?this.$t("people.delete_text",{personName:s}):""},searchField(){return this.$refs["search-field"]}},methods:{...x(["clearPersonAvatar","deletePeople","editPerson","generateToken","loadDepartments","loadPeople","newPerson","setPeopleSearch","uploadPersonAvatar"]),async deleteAvatar(){this.loading.deletingAvatar=!0;try{await this.clearPersonAvatar(this.personToEdit),this.modals.avatar=!1}catch{this.errors.avatar=!0}this.loading.deletingAvatar=!1},async updateAvatar(s){this.loading.updatingAvatar=!0;try{await this.uploadPersonAvatar({person:this.personToEdit,formData:s}),this.modals.avatar=!1}catch{this.errors.avatar=!0}this.loading.updatingAvatar=!1},confirmGenerateToken(s){this.generateToken(s).then(e=>{this.updatePersonToEdit(e)}).catch(console.error)},confirmEditPeople(s){let e="editPerson";this.personToEdit.id===void 0?e="newPerson":s.id=this.personToEdit.id,this.loading.edit=!0,this.errors.edit=!1,this.errors.userLimit=!1,this[e](s).then(t=>{this.loading.edit=!1,this.modals.edit=!1;const a=t.access_token;a!=null&&a.length&&(this.updatePersonToEdit(t),this.modals.newToken=!0)}).catch(t=>{var i;console.error(t);const a=(i=t.body)==null?void 0:i.message;typeof a=="string"&&a.includes("limit")?this.errors.userLimit=!0:this.errors.edit=!0,this.loading.edit=!1})},confirmDeletePeople(){this.loading.del=!0,this.errors.del=!1,this.deletePeople(this.personToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(s=>{console.error(s),this.loading.del=!1,this.errors.del=!0})},onSearchChange(){if(!this.searchField)return;const s=this.searchField.getValue();s.length!==1&&(this.setPeopleSearch(s),this.updateRoute())},onAvatarClicked(s){this.updatePersonToEdit(s),this.errors.avatar=!1,this.modals.avatar=!0},onDeleteClicked(s){this.personToDelete=s,this.modals.del=!0},onEditClicked(s){this.updatePersonToEdit(s),this.modals.edit=!0},onRefreshClicked(s){this.updatePersonToEdit(s),this.modals.newToken=!0},onNewClicked(){this.updatePersonToEdit({role:"user"}),this.modals.edit=!0},updatePersonToEdit(s){this.personToEdit={...s,expiration_date:s.expiration_date?new Date(s.expiration_date):null}},updateRoute(){const s=this.searchField.getValue(),e=this.selectedDepartment,t=this.role;this.$router.push({query:{search:s,department:e,role:t}})}},metaInfo(){return{title:`${this.$t("bots.title")} - Kitsu`}}};var A=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bots page fixed-page"},[t("div",{staticClass:"flexrow page-header"},[t("page-title",{staticClass:"flexrow-item filler",attrs:{text:e.$t("bots.title")}}),e.isCurrentUserAdmin?t("button-simple",{staticClass:"flexrow-item",attrs:{text:e.$t("bots.new_bot"),"is-responsive":!0,icon:"plus"},on:{click:e.onNewClicked}}):e._e()],1),t("div",{staticClass:"flexrow search-options"},[t("search-field",{ref:"search-field",staticClass:"search flexrow-item",attrs:{placeholder:"ex: gazu bot"},on:{change:e.onSearchChange}}),t("combobox-department",{staticClass:"combobox-department flexrow-item",attrs:{label:e.$t("main.department")},model:{value:e.selectedDepartment,callback:function(a){e.selectedDepartment=a},expression:"selectedDepartment"}}),t("combobox-styled",{staticClass:"flexrow-item",attrs:{label:e.$t("people.fields.role"),options:e.roleOptions,"locale-key-prefix":"people.role.","no-margin":""},model:{value:e.role,callback:function(a){e.role=a},expression:"role"}})],1),t("div",{staticClass:"query-list"}),t("people-list",{attrs:{entries:e.currentPeople,"is-bots":!0,"is-loading":e.isPeopleLoading,"is-error":e.isPeopleLoadingError},on:{"avatar-clicked":e.onAvatarClicked,"delete-clicked":e.onDeleteClicked,"edit-clicked":e.onEditClicked,"refresh-clicked":e.onRefreshClicked}}),t("edit-avatar-modal",{attrs:{active:e.modals.avatar,"error-text":e.$t("bots.edit_avatar_error"),"is-deleting":e.loading.deletingAvatar,"is-error":e.errors.avatar,"is-updating":e.loading.updatingAvatar,person:e.personToEdit},on:{close:function(a){e.modals.avatar=!1},delete:e.deleteAvatar,update:e.updateAvatar}}),t("edit-person-modal",{attrs:{active:e.modals.edit,"is-bot":!0,"is-error":e.errors.edit,"is-loading":e.loading.edit,"is-user-limit-error":e.errors.userLimit,"person-to-edit":e.personToEdit},on:{cancel:function(a){e.modals.edit=!1},confirm:e.confirmEditPeople}}),t("new-token-modal",{attrs:{active:e.modals.newToken,person:e.personToEdit},on:{cancel:function(a){e.modals.newToken=!1},close:function(a){e.modals.newToken=!1},"generate-token":e.confirmGenerateToken}}),t("hard-delete-modal",{attrs:{active:e.modals.del,"error-text":e.$t("people.delete_error"),"is-loading":e.loading.del,"is-error":e.errors.del,"lock-text":e.personToDelete?e.personToDelete.full_name:"",text:e.deleteText},on:{cancel:function(a){e.modals.del=!1},confirm:e.confirmDeletePeople}})],1)},F=[],L=o(E,A,F,!1,null,"09e84613",null,null);const U=L.exports;export{U as default};
//# sourceMappingURL=Bots-BXKmJLWC.js.map
