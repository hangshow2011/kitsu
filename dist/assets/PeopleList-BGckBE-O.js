import{n as l,l as o,a7 as n,S as c,o as d,G as p,w as m,U as f,q as _,m as r,A as u,j as v,g as h}from"./index-Djh35xFL.js";import{D as b}from"./DepartmentNamesCell-ZJxbedBQ.js";import{P as C}from"./PeopleNameCell-DdD0Nxh7.js";const x={name:"edit-avatar-modal",mixins:[o],components:{PeopleAvatar:n,Spinner:c},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isDeleting:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isUpdating:{type:Boolean,default:!1},person:{type:Object,required:!0}},methods:{selectFile(){this.$refs["input-file"].click()},updateAvatar(a){const e=a.target.files[0],t=new FormData;t.append("file",e,e.name),this.$emit("update",t)},deleteAvatar(){this.$emit("delete")},close(){this.isUpdating||this.isDeleting||this.$emit("close")},resetForm(){this.$refs["input-file"].value=null}},watch:{active(){this.active&&this.resetForm()}}};var g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal",class:{"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:e.close}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("profile.avatar.title"))+" ")]),t("form",[t("input",{ref:"input-file",staticClass:"hidden",attrs:{type:"file",accept:".png,.jpg,.jpeg"},on:{change:e.updateAvatar}}),t("people-avatar",{attrs:{"is-lazy":!1,person:this.person,size:150,"font-size":60}}),t("div",{staticClass:"flexrow right mt2"},[t("button",{staticClass:"button flexrow-item is-primary",attrs:{disabled:e.isUpdating||e.isDeleting,type:"button"},on:{click:e.selectFile}},[e.isUpdating?[t("spinner",{staticClass:"mr05 mt05",attrs:{size:20,"is-white":""}}),e._v(" "+e._s(e.$t("profile.avatar.updating"))+" ")]:[e._v(e._s(e.$t("profile.change_avatar")))]],2),t("button",{staticClass:"button flexrow-item",attrs:{disabled:e.isUpdating||e.isDeleting,type:"button"},on:{click:e.deleteAvatar}},[e.isDeleting?[t("spinner",{staticClass:"mr05 mt05",attrs:{size:20}}),e._v(" "+e._s(e.$t("profile.avatar.removing"))+" ")]:[e._v(e._s(e.$t("profile.clear_avatar")))]],2),t("button",{staticClass:"button flexrow-item is-link",attrs:{disabled:e.isUpdating||e.isDeleting,type:"button"},on:{click:e.close}},[e._v(" "+e._s(e.$t("main.close"))+" ")])])],1),e.isError?t("p",{staticClass:"error mt1 has-text-right"},[e._v(" "+e._s(e.errorText)+" ")]):e._e()])])])},$=[],E=l(x,g,$,!1,null,"0a316d62",null,null);const S=E.exports,B={name:"edit-person-modal",mixins:[o],components:{Combobox:d,ComboboxDepartment:p,DateField:m,DepartmentName:f,TextField:_},props:{active:{type:Boolean,default:!1},isBot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],contractOptions:[{label:"open-ended",value:"open-ended"},{label:"fixed-term",value:"fixed-term"},{label:"short-term",value:"short-term"},{label:"freelance",value:"freelance"},{label:"apprentice",value:"apprentice"},{label:"internship",value:"internship"}],form:{first_name:"",last_name:"",email:"",phone:"",role:"user",contract_type:"open-ended",active:"true",departments:[],expiration_date:null,is_bot:!1},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],selectedDepartment:null}},computed:{...r(["departments","departmentMap","isCurrentUserAdmin","people","user"]),selectableDepartments(){return this.departments.filter(a=>!this.form.departments.includes(a.id))},isEditing(){var a;return!!((a=this.personToEdit)!=null&&a.id)},isValidName(){var a;return!!((a=this.form.first_name)!=null&&a.length)},isValidEmail(){var t;return!((t=this.form.email)!=null&&t.length)||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.form.email)?!1:this.form.is_bot?!0:!this.people.some(s=>!s.is_bot&&s.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==s.email))},isValidForm(){return this.isValidName&&this.isValidEmail}},methods:{emitForm(a){if(!this.isValidForm)return;const e={...this.form,last_name:this.form.last_name||"",active:this.form.active==="true"||this.form.active===!0};this.$emit(a,e)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(a){const e=this.form.departments.indexOf(a);e>=0&&this.form.departments.splice(e,1)},resetForm(){this.isEditing?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,email:this.personToEdit.email,phone:this.personToEdit.phone,role:this.personToEdit.role,contract_type:this.personToEdit.contract_type,active:this.personToEdit.active?"true":"false",departments:[...this.personToEdit.departments||[]],expiration_date:this.personToEdit.expiration_date,is_bot:this.personToEdit.is_bot}:this.form={role:"user",contract_type:"open-ended",active:"true",departments:[],expiration_date:null,is_bot:this.isBot,email:this.isBot?this.user.email:null}}},watch:{personToEdit(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs["name-field"].focus()},100))}}};var y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal",class:{"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(s){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("form",{staticClass:"box",on:{submit:function(s){return s.preventDefault(),e.emitForm("confirm")}}},[e.personToEdit.id!==void 0?t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("people.edit_title"))+" "+e._s(e.personToEdit.full_name)+" ")]):t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t(e.isBot?"bots.new_bot":"people.new_person"))+" ")]),t("text-field",{ref:"name-field",attrs:{errored:e.form.first_name&&!e.isValidName,label:e.$t(e.isBot?"bots.fields.name":"people.fields.first_name"),disabled:e.personToEdit.is_generated_from_ldap},model:{value:e.form.first_name,callback:function(s){e.$set(e.form,"first_name",typeof s=="string"?s.trim():s)},expression:"form.first_name"}}),e.isBot?e._e():t("text-field",{attrs:{label:e.$t("people.fields.last_name"),disabled:e.personToEdit.is_generated_from_ldap},model:{value:e.form.last_name,callback:function(s){e.$set(e.form,"last_name",typeof s=="string"?s.trim():s)},expression:"form.last_name"}}),e.isBot?e._e():t("text-field",{attrs:{type:"email",errored:e.form.email&&!e.isValidEmail,label:e.$t("people.fields.email"),disabled:e.personToEdit.is_generated_from_ldap},model:{value:e.form.email,callback:function(s){e.$set(e.form,"email",typeof s=="string"?s.trim():s)},expression:"form.email"}}),e.isBot?e._e():t("text-field",{attrs:{label:e.$t("people.fields.phone")},model:{value:e.form.phone,callback:function(s){e.$set(e.form,"phone",typeof s=="string"?s.trim():s)},expression:"form.phone"}}),e.isBot?t("date-field",{attrs:{label:e.$t("bots.fields.expiration_date"),"disabled-dates":{to:new Date},disabled:e.isEditing},model:{value:e.form.expiration_date,callback:function(s){e.$set(e.form,"expiration_date",s)},expression:"form.expiration_date"}}):e._e(),t("div",{staticClass:"departments field"},[t("label",{staticClass:"label"},[e._v(e._s(e.$t("people.fields.departments")))]),e.form.departments&&e.form.departments.length===0?t("p",{staticClass:"empty mb1"},[e._v(" "+e._s(e.$t("people.departments_empty"))+" ")]):e._e(),e._l(e.form.departments,function(s){return t("div",{key:s,staticClass:"department-element mb1 mt05",on:{click:function(i){return e.removeDepartment(s)}}},[s?t("department-name",{attrs:{department:e.departmentMap.get(s)}}):e._e()],1)}),t("div",{staticClass:"flexrow"},[e.selectableDepartments.length>0?t("combobox-department",{staticClass:"flexrow-item",attrs:{"selectable-departments":e.selectableDepartments},model:{value:e.selectedDepartment,callback:function(s){e.selectedDepartment=s},expression:"selectedDepartment"}}):e._e(),e.selectableDepartments.length>0?t("button",{staticClass:"button is-success flexrow-item",class:{"is-disabled":e.selectedDepartment===null},attrs:{type:"button"},on:{click:e.addDepartment}},[e._v(" "+e._s(e.$t("main.add"))+" ")]):e._e()],1)],2),t("combobox",{attrs:{label:e.$t("people.fields.role"),options:e.roleOptions,localeKeyPrefix:"people.role."},model:{value:e.form.role,callback:function(s){e.$set(e.form,"role",s)},expression:"form.role"}}),e.isBot?e._e():t("combobox",{attrs:{label:e.$t("people.fields.contract"),options:e.contractOptions,localeKeyPrefix:"people.contract."},model:{value:e.form.contract_type,callback:function(s){e.$set(e.form,"contract_type",s)},expression:"form.contract_type"}}),t("combobox",{attrs:{label:e.$t("people.fields.active"),options:e.activeOptions,disabled:e.personToEdit.is_generated_from_ldap},model:{value:e.form.active,callback:function(s){e.$set(e.form,"active",s)},expression:"form.active"}}),t("div",{staticClass:"flexrow"},[e.isEditing&&e.isCurrentUserAdmin&&!e.isBot?t("button",{staticClass:"button flexrow-item",class:{"is-loading":e.isInviteLoading},attrs:{disabled:!e.isValidEmail,type:"button"},on:{click:function(s){return e.emitForm("invite")}}},[e._v(" "+e._s(e.$t("people.invite"))+" ")]):e._e(),t("div",{staticClass:"filler"}),!e.isEditing&&e.isCurrentUserAdmin&&!e.isBot?t("button",{staticClass:"button is-primary flexrow-item",class:{"is-loading":e.isCreateInviteLoading},attrs:{disabled:!e.isValidForm,type:"button"},on:{click:function(s){return e.emitForm("confirm-invite")}}},[e._v(" "+e._s(e.$t("people.create_invite"))+" ")]):e._e(),t("button",{staticClass:"button is-primary flexrow-item",class:{"is-loading":e.isLoading},attrs:{disabled:!e.isValidForm,type:"submit"}},[e._v(" "+e._s(e.isEditing?e.$t("people.confirm_edit"):e.$t("people.create"))+" ")]),t("button",{staticClass:"button is-link flexrow-item",attrs:{type:"button"},on:{click:function(s){return e.$emit("cancel")}}},[e._v(" "+e._s(e.$t("main.cancel"))+" ")])]),e.isInvitationSuccess?t("div",{staticClass:"success has-text-right mt1"},[e._v(" "+e._s(e.$t("people.invite_success"))+" ")]):e._e(),e.isInvitationError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.invite_error"))+" ")]):e._e(),e.isUserLimitError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.user_limit_error"))+" ")]):e._e(),e.isError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.create_error"))+" ")]):e._e()],1)])])},k=[],w=l(B,y,k,!1,null,"591f3071",null,null);const O=w.exports,D={name:"people-list",components:{AlertTriangleIcon:u,DepartmentNamesCell:b,PeopleNameCell:C,RowActionsCell:v,TableInfo:h},props:{entries:{type:Array,default:()=>[]},isBots:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},computed:{...r(["departmentMap","isCurrentUserAdmin"]),activePeople(){return this.entries.filter(a=>a.active)},today(){return new Date().toJSON().slice(0,10)},nextWeek(){const a=new Date;return a.setDate(a.getDate()+7),a.toJSON().slice(0,10)},unactivePeople(){return this.entries.filter(a=>!a.active)},nbUsersDetails(){const a=this.entries.length,e=this.activePeople.length,t=this.$tc(this.isBots?"bots.bots":"people.persons",a),s=this.$tc(this.isBots?"bots.active_bots":"people.active_persons",e);return`${a} ${t} (${e} ${s})`}},methods:{isExpired(a){return a<this.today},isSoonExpired(a){return!this.isExpired(a)&&a<this.nextWeek},onBodyScroll(a,e){this.$refs.body.style.left=`-${e.scrollLeft}px`}}};var T=function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-list"},[t("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[t("table",{staticClass:"datatable multi-section"},[t("thead",{staticClass:"datatable-head"},[t("tr",[t("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.name"))+" ")]),e.isBots?e._e():t("th",{staticClass:"email",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.email"))+" ")]),e.isBots?e._e():t("th",{staticClass:"phone",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.phone"))+" ")]),e.isBots?t("th",{staticClass:"expiration",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.expiration"))+" ")]):e._e(),t("th",{staticClass:"role",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.role"))+" ")]),e.isBots?e._e():t("th",{staticClass:"contract",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.contract"))+" ")]),t("th",{staticClass:"departments",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.departments"))+" ")]),t("th",{staticClass:"actions",attrs:{scope:"col"}})])]),e.activePeople.length>0?t("tbody",{staticClass:"datatable-body"},[t("tr",{staticClass:"datatable-type-header"},[t("th",{attrs:{scope:"rowgroup",colspan:"5"}},[t("span",{staticClass:"datatable-row-header"},[e._v(e._s(e.$t("people.active")))])])]),e._l(e.activePeople,function(s){return t("tr",{key:s.id,staticClass:"datatable-row"},[t("people-name-cell",{staticClass:"name datatable-row-header",attrs:{person:s}}),e.isBots?e._e():t("td",{staticClass:"email"},[e._v(e._s(s.email))]),e.isBots?e._e():t("td",{staticClass:"phone"},[e._v(e._s(s.phone))]),e.isBots?t("td",{staticClass:"expiration",class:{error:e.isExpired(s.expiration_date),warning:e.isSoonExpired(s.expiration_date)}},[e._v(" "+e._s(s.expiration_date)+" "),t("alert-triangle-icon",{staticClass:"icon"})],1):e._e(),t("td",{staticClass:"role"},[e._v(e._s(e.$t("people.role."+s.role)))]),e.isBots?e._e():t("td",{staticClass:"contract"},[e._v(" "+e._s(e.$t("people.contract."+s.contract_type))+" ")]),t("department-names-cell",{staticClass:"departments",attrs:{departments:s.departments}}),e.isCurrentUserAdmin?t("row-actions-cell",{attrs:{"entry-id":s.id,"hide-avatar":!1,"hide-change-password":e.isBots,"hide-delete":!0,"hide-refresh":!e.isBots},on:{"avatar-clicked":function(i){return e.$emit("avatar-clicked",s)},"change-password-clicked":function(i){return e.$emit("change-password-clicked",s)},"edit-clicked":function(i){return e.$emit("edit-clicked",s)},"refresh-clicked":function(i){return e.$emit("refresh-clicked",s)}}}):t("td",{staticClass:"actions"})],1)})],2):e._e(),e.unactivePeople.length>0?t("tbody",{staticClass:"datatable-body"},[t("tr",{staticClass:"datatable-type-header"},[t("th",{attrs:{scope:"rowgroup",colspan:"5"}},[t("span",{staticClass:"datatable-row-header"},[e._v(" "+e._s(e.$t("people.unactive"))+" ")])])]),e._l(e.unactivePeople,function(s){return t("tr",{key:s.id,staticClass:"datatable-row"},[t("people-name-cell",{staticClass:"name datatable-row-header",attrs:{person:s}}),e.isBots?e._e():t("td",{staticClass:"email"},[e._v(e._s(s.email))]),e.isBots?e._e():t("td",{staticClass:"phone"},[e._v(e._s(s.phone))]),e.isBots?t("td",{staticClass:"expiration"},[e._v(" "+e._s(s.expiration_date)+" ")]):e._e(),t("td",{staticClass:"role"},[e._v(e._s(e.$t("people.role."+s.role)))]),e.isBots?e._e():t("td",{staticClass:"contract"},[e._v(" "+e._s(e.$t("people.contract."+s.contract_type))+" ")]),t("department-names-cell",{staticClass:"departments",attrs:{departments:s.departments}}),e.isCurrentUserAdmin?t("row-actions-cell",{attrs:{"entry-id":s.id},on:{"edit-clicked":function(i){return e.$emit("edit-clicked",s)},"delete-clicked":function(i){return e.$emit("delete-clicked",s)}}}):t("td",{staticClass:"actions"})],1)})],2):e._e()])]),t("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),e.isLoading?e._e():t("p",{staticClass:"has-text-centered footer-info"},[e._v(" "+e._s(e.nbUsersDetails)+" ")])],1)},F=[],U=l(D,T,F,!1,null,"e0fddedc",null,null);const V=U.exports;export{S as E,V as P,O as a};
//# sourceMappingURL=PeopleList-BGckBE-O.js.map
