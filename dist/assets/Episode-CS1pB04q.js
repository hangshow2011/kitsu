import{f as r,B as n,C as o,H as c,b as d,D as l,d as u,P as p,J as h,e as m,g as f,h as g,i as v,m as _,a as y,as as E,n as C}from"./index-Djh35xFL.js";import{e as b,E as w,a as k,b as x,c as S}from"./EntityTaskList-Dj0XUxYB.js";import{E as T}from"./EditEpisodeModal-DjKiljV5.js";import"./PeopleNameCell-DdD0Nxh7.js";const L={name:"episode",mixins:[b,r],components:{ButtonSimple:n,ComboboxNumber:o,ComboboxStyled:c,CornerLeftUpIcon:d,DescriptionCell:l,EditEpisodeModal:T,EntityNews:w,EntityPreviewFiles:k,EntityTaskList:x,EntityTimeLogs:S,EntityThumbnail:u,PageSubtitle:p,PageTitle:h,Schedule:m,TableInfo:f,TaskInfo:g,TaskTypeName:v},data(){return{type:"episode",currentEpisode:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.loadCurrentEpisode().then(s=>{this.currentEpisode=s,this.currentSection=this.route.query.section||"casting",this.casting.isLoading=!0,this.casting.isError=!1,this.currentEpisode?this.loadEpisodeCasting(this.currentEpisode).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(e)}):this.resetData()}).catch(console.error)},computed:{..._(["currentProduction","getTaskTypePriority","episodeMap","episodeMetadataDescriptors","episodeSearchText","isCurrentUserManager","route","taskMap","taskTypeMap"]),title(){return this.currentEpisode?`${this.currentEpisode.name}`:"Loading..."},currentEntity(){return this.currentEpisode},getEpisodesRoute(){const s={name:"episodes",params:{production_id:this.currentProduction.id,project_id:this.currentProduction.id},query:{search:this.episodeSearchText}};return s.name="episodes",s},nbAssets(){let s=0;return this.currentEpisode&&this.currentSection==="casting"&&this.currentEpisode.castingAssetsByType&&this.currentEpisode.castingAssetsByType.forEach(e=>{s+=e.length}),s}},methods:{...y(["clearSelectedTasks","editEpisode","setCurrentEpisode","loadEpisodesWithTasks","loadEpisodeCasting"]),loadCurrentEpisode(){return new Promise((s,e)=>{const t=this.route.params.episode_id,i=this.episodeMap.get(t)||null;return!i||!i.validations?this.loadEpisodesWithTasks().then(()=>{const a=this.episodeMap.get(t)||null;return s(a)}):s(i)})},confirmEditEpisode(s){s.id=this.currentEpisode.id,this.loading.edit=!0,this.errors.edit=!1,this.editEpisode(s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(e=>{console.error(e),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(s){const e=this.currentEpisode.id,t={name:"asset",params:{production_id:this.currentProduction.id,asset_id:s.asset_id}};return E(t,e)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentEpisode().then(s=>(this.currentEpisode=s,this.loadEpisodeCasting(this.currentEpisode))).then(()=>{this.casting.isLoading=!1}).catch(s=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(s)})})}},watch:{},metaInfo(){return{title:`${this.title} - Kitsu`}}};var M=function(){var e=this,t=e._self._c;return t("div",{staticClass:"columns fixed-page episode xyz-in",attrs:{xyz:"fade"}},[t("div",{staticClass:"column main-column"},[t("div",{staticClass:"page-header flexrow"},[t("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:e.getEpisodesRoute}},[t("corner-left-up-icon")],1),t("span",{staticClass:"flexrow-item ml2"},[e.currentEpisode?t("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:e.currentEpisode,"empty-width":120,"empty-height":50,width:120}}):e._e()],1),t("div",{staticClass:"flexrow-item"},[t("page-title",{staticClass:"entity-title",attrs:{text:e.title}})],1)],1),t("div",{staticClass:"flexrow infos"},[t("div",{staticClass:"flexrow-item block flexcolumn"},[t("page-subtitle",{attrs:{text:e.$t("episodes.tasks")}}),t("entity-task-list",{staticClass:"task-list",attrs:{entries:e.currentTasks,"is-loading":!e.currentEpisode,"is-error":!1},on:{"task-selected":e.onTaskSelected}})],1),t("div",{staticClass:"flexrow-item block flexcolumn"},[t("div",{staticClass:"flexrow"},[t("page-subtitle",{attrs:{text:e.$t("main.info")}}),t("div",{staticClass:"filler"}),t("div",{staticClass:"flexrow-item has-text-right"},[e.isCurrentUserManager?t("button-simple",{attrs:{icon:"edit"},on:{click:function(i){e.modals.edit=!0}}}):e._e()],1)],1),t("div",{staticClass:"table-body"},[e.currentEpisode?t("table",{staticClass:"datatable no-header"},[t("tbody",{staticClass:"datatable-body"},[t("tr",{staticClass:"datatable-row"},[t("td",{staticClass:"field-label"},[e._v(" "+e._s(e.$t("shots.fields.description"))+" ")]),t("description-cell",{attrs:{entry:e.currentEpisode,full:!0}})],1),e._l(e.episodeMetadataDescriptors,function(i){return t("tr",{key:i.id,staticClass:"datatable-row"},[t("td",{staticClass:"field-label"},[e._v(e._s(i.name))]),t("td",[e._v(" "+e._s(e.currentEpisode&&e.currentEpisode.data?e.currentEpisode.data[i.field_name]:"")+" ")])])})],2)]):e._e()])])]),t("div",{staticClass:"episode-data block"},[t("div",{staticClass:"flexrow"},[t("combobox-styled",{staticClass:"section-combo flexrow-item",attrs:{options:e.entityNavOptions},model:{value:e.currentSection,callback:function(i){e.currentSection=i},expression:"currentSection"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="casting",expression:"currentSection === 'casting'"}]},[e._v(" "+e._s(e.nbAssets)+" "+e._s(e.$tc("assets.number",e.nbAssets))+" ")]),t("span",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="casting"&&e.currentEpisode.is_casting_standby,expression:`
            currentSection === 'casting' && currentEpisode.is_casting_standby
          `}],staticClass:"tag tag-standby"},[e._v(" "+e._s(e.$t("breakdown.fields.standby"))+" ")]),t("div",{staticClass:"filler"}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"flexrow-item mt05"},[e._v(" "+e._s(e.$t("schedule.zoom_level"))+": ")]),t("combobox-number",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"zoom-level flexrow-item",attrs:{options:e.zoomOptions,"is-simple":""},model:{value:e.zoomLevel,callback:function(i){e.zoomLevel=i},expression:"zoomLevel"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="casting",expression:"currentSection === 'casting'"}],staticClass:"episode-casting"},[e.currentEpisode?t("div",[e.currentEpisode&&e.currentEpisode.castingAssetsByType&&e.currentEpisode.castingAssetsByType[0].length>0?t("div",e._l(e.currentEpisode.castingAssetsByType,function(i){return t("div",{key:i.length>0?i[0].asset_type_name:"",staticClass:"type-assets"},[t("div",{staticClass:"asset-type"},[e._v(" "+e._s(i.length>0?i[0].asset_type_name:"")+" ("+e._s(i.length)+") ")]),t("div",{staticClass:"asset-list"},e._l(i,function(a){return t("router-link",{key:a.id,staticClass:"asset-link",attrs:{to:e.buildAssetRoute(a)}},[t("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:a,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),t("div",{staticClass:"break-word"},[e._v(" "+e._s(a.asset_name)+" "),a.nb_occurences>1?t("span",[e._v(" ("+e._s(a.nb_occurences)+") ")]):e._e()]),t("div",{staticClass:"ready-for flexrow"},[a.ready_for?t("task-type-name",{staticClass:"flexrow-item",attrs:{"task-type":e.taskTypeMap.get(a.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(a.ready_for).name}}):e._e()],1)],1)}),1)])}),0):t("div",{staticClass:"mt1"},[e._v(" "+e._s(e.$t("episodes.no_casting"))+" ")])]):t("table-info",{attrs:{"is-loading":e.casting.isLoading,"is-error":e.casting.isError}})],1),e.scheduleItems[0].children.length>0?t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"schedule mt1"},[t("div",{staticClass:"wrapper"},[t("schedule",{ref:"schedule-widget",attrs:{"start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1}})],1)]):t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"mt1"},[e._v(" "+e._s(e.$t("main.empty_schedule"))+" ")]),e.currentSection==="preview-files"?t("entity-preview-files",{attrs:{entity:e.currentEpisode}}):e._e(),e.currentSection==="activity"?t("entity-news",{attrs:{entity:e.currentEpisode}}):e._e(),e.currentSection==="time-logs"?t("entity-time-logs",{attrs:{entity:e.currentEpisode}}):e._e()],1)]),e.currentTask?t("div",{staticClass:"column side-column"},[t("task-info",{attrs:{task:e.currentTask,"entity-type":"Episode","with-actions":""}})],1):e._e(),t("edit-episode-modal",{ref:"edit-episode-modal",attrs:{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"episode-to-edit":e.currentEpisode},on:{cancel:function(i){e.modals.edit=!1},confirm:e.confirmEditEpisode}})],1)},$=[],z=C(L,M,$,!1,null,"3ac0bce9",null,null);const A=z.exports;export{A as default};
//# sourceMappingURL=Episode-CS1pB04q.js.map
