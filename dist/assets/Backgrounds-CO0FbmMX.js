import{n as r,j as o,g as l,l as n,p as d,F as c,M as u,q as f,t as m,m as h,a as b}from"./index-Djh35xFL.js";import{B as g}from"./BooleanCell-FUnctL_-.js";import{B as k}from"./BooleanField-DDej8-5N.js";import{L as _}from"./ListPageHeader-g21-5tZQ.js";import{R as v}from"./RouteTabs-C-8rSXTd.js";const p={name:"background-list",props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{BooleanCell:g,RowActionsCell:o,TableInfo:l}};var $=function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-list"},[t("div",{staticClass:"datatable-wrapper"},[t("table",{staticClass:"datatable"},[t("thead",{staticClass:"datatable-head"},[t("tr",[t("th",{staticClass:"name",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("backgrounds.fields.name"))+" ")]),t("th",{staticClass:"is-default",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("backgrounds.fields.is_default"))+" ")]),t("th",{staticClass:"actions",attrs:{scope:"col"}})])]),t("tbody",{staticClass:"datatable-body"},e._l(e.entries,function(a){return t("tr",{key:a.id,staticClass:"datatable-row"},[t("td",{staticClass:"name"},[t("span",{staticClass:"flexrow"},[t("a",{staticClass:"thumbnail-wrapper thumbnail-picture entity-thumbnail flexrow-item",attrs:{href:a.url,target:"_blank"}},[t("img",{attrs:{src:a.thumbnail,alt:a.name,width:"100",height:"67"}})]),e._v(" "+e._s(a.name)+" ")])]),t("boolean-cell",{staticClass:"is-default",attrs:{value:a.is_default}}),t("row-actions-cell",{attrs:{"entry-id":a.id,"hide-delete":a.is_default===!0},on:{"edit-clicked":function(s){return e.$emit("edit-clicked",a)},"delete-clicked":function(s){return e.$emit("delete-clicked",a)}}})],1)}),0)])]),t("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),t("p",{staticClass:"has-text-centered"},[e._v(" "+e._s(e.entries.length)+" "+e._s(e.$tc("backgrounds.number",e.entries.length))+" ")])],1)},C=[],E=r(p,$,C,!1,null,"839f0f07",null,null);const T=E.exports,x={name:"edit-task-status-modal",mixins:[n],components:{BooleanField:k,ComboboxBoolean:d,FileUpload:c,ModalFooter:u,TextField:f},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},backgroundToEdit:{type:Object,default:()=>{}}},data(){return{form:{file:null,name:"",is_default:"false",archived:"false"}}},computed:{isEditing(){var i;return(i=this.backgroundToEdit)==null?void 0:i.id}},methods:{confirmClicked(){if(!(!this.isEditing&&!this.form.file)){if(!this.form.name){this.$refs.nameField.focus();return}this.$emit("confirm",{...this.form,is_default:this.form.is_default==="true",archived:this.form.archived==="true"})}},onFileSelected(i){const e=i.get("file");this.form.file=i,this.form.name.length||(this.form.name=e.name.slice(0,-4)),this.$nextTick(()=>{this.$refs.nameField.focus()})},resetForm(){var i;this.backgroundToEdit&&(this.form={file:null,name:this.backgroundToEdit.name||"",is_default:String(this.backgroundToEdit.is_default||!1),archived:String(this.backgroundToEdit.archived||!1)},(i=this.$refs.fileUpload)==null||i.reset())}},watch:{backgroundToEdit(){this.resetForm()},active(){this.active&&this.resetForm()}}};var B=function(){var e=this,t=e._self._c;return t("div",{class:{modal:!0,"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(a){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[e.isEditing?t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("backgrounds.edit_background"))+" "+e._s(e.backgroundToEdit.name)+" ")]):t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("backgrounds.new_background"))+" ")]),t("form",{on:{submit:function(a){a.preventDefault()}}},[e.isEditing?e._e():t("div",{staticClass:"field"},[t("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("backgrounds.fields.file")))]),t("file-upload",{ref:"fileUpload",attrs:{label:e.$t("main.select_file"),accept:".hdr","is-primary":!1},on:{fileselected:e.onFileSelected}})],1),t("text-field",{ref:"nameField",attrs:{"input-class":"task-status-name",label:e.$t("backgrounds.fields.name"),maxlength:40},on:{enter:e.confirmClicked},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",typeof a=="string"?a.trim():a)},expression:"form.name"}}),t("boolean-field",{attrs:{label:e.$t("backgrounds.fields.is_default")},on:{enter:e.confirmClicked},model:{value:e.form.is_default,callback:function(a){e.$set(e.form,"is_default",a)},expression:"form.is_default"}}),e.isEditing?t("combobox-boolean",{attrs:{label:e.$t("main.archived")},on:{enter:e.confirmClicked},model:{value:e.form.archived,callback:function(a){e.$set(e.form,"archived",a)},expression:"form.archived"}}):e._e()],1),t("modal-footer",{attrs:{"error-text":e.$t("backgrounds.create_error"),"is-error":e.isError,"is-loading":e.isLoading},on:{confirm:e.confirmClicked,cancel:function(a){return e.$emit("cancel")}}})],1)])])},w=[],F=r(x,B,w,!1,null,"a1f00688",null,null);const y=F.exports,L={name:"backgrounds",components:{BackgroundList:T,DeleteModal:m,EditBackgroundModal:y,ListPageHeader:_,RouteTabs:v},data(){return{activeTab:"active",backgroundToEdit:{},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active"},computed:{...h(["archivedBackgrounds","backgrounds"]),backgroundsList(){return this.activeTab==="active"?this.backgrounds:this.archivedBackgrounds}},methods:{...b(["deleteBackground"]),confirmEditBackground(i){var a;const e=!((a=this.backgroundToEdit)!=null&&a.id);let t="newBackground";e||(t="saveBackground",i.id=this.backgroundToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,i).then(()=>{this.modals.edit=!1}).catch(s=>{console.error(s),this.errors.edit=!0}).finally(()=>{this.loading.edit=!1})},confirmDeleteBackground(){this.loading.del=!0,this.errors.del=!1,this.deleteBackground(this.backgroundToDelete).then(()=>{this.modals.del=!1}).catch(i=>{console.error(i),this.errors.del=!0}).finally(()=>{this.loading.del=!1})},deleteText(){const i=this.backgroundToDelete;return i?this.$t("backgrounds.delete_text",{name:i.name}):""},onNewClicked(){this.backgroundToEdit={},this.modals.edit=!0},onEditClicked(i){this.backgroundToEdit=i,this.modals.edit=!0},onDeleteClicked(i){this.backgroundToDelete=i,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},metaInfo(){return{title:`${this.$t("backgrounds.title")} - Kitsu`}}};var D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"backgrounds page fixed-page"},[t("list-page-header",{attrs:{title:e.$t("backgrounds.title"),"new-entry-label":e.$t("backgrounds.new_background"),"is-exportable":!1},on:{"new-clicked":e.onNewClicked}}),t("route-tabs",{staticClass:"mt2",attrs:{"active-tab":e.activeTab,tabs:e.tabs,"route-name":"backgrounds"}}),t("background-list",{attrs:{entries:e.backgroundsList,"is-loading":e.loading.list,"is-error":e.errors.list},on:{"edit-clicked":e.onEditClicked,"delete-clicked":e.onDeleteClicked}}),t("edit-background-modal",{attrs:{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"background-to-edit":e.backgroundToEdit},on:{cancel:function(a){e.modals.edit=!1},confirm:e.confirmEditBackground}}),t("delete-modal",{attrs:{active:e.modals.del,"is-loading":e.loading.del,"is-error":e.errors.del,text:e.deleteText(),"error-text":e.$t("backgrounds.delete_error")},on:{cancel:function(a){e.modals.del=!1},confirm:e.confirmDeleteBackground}})],1)},R=[],M=r(L,D,R,!1,null,null,null,null);const j=M.exports;export{j as default};
//# sourceMappingURL=Backgrounds-CO0FbmMX.js.map
