import{n as h,Q as p,B as c,o as y,b8 as u,bi as _,bj as f,P as g,bk as P,bl as m,K as v,S as w,i as E,bm as S,b0 as n,m as b,a as T,bn as k,bo as C,an as x,aN as M,ab as o,bp as d,bq as A,br as $}from"./index-Djh35xFL.js";const D={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}};var L=function(){var t=this,s=t._self._c;return s("p",{class:{error:!0,"has-text-right":t.alignRight,"is-hidden":t.hidden}},[t._v(" "+t._s(t.text)+" ")])},F=[],q=h(D,L,F,!1,null,null,null,null);const B=q.exports,j={name:"playlist",components:{BuildFilterModal:p,ButtonSimple:c,Combobox:y,ComboboxTaskType:u,ErrorText:B,EditPlaylistModal:_,LightEntityThumbnail:f,PageSubtitle:g,PlaylistPlayer:P,PlusIcon:m,SearchField:v,Spinner:w,TaskTypeName:E,XIcon:S},data(){return{currentPlaylist:{name:""},currentSort:"updated_at",currentEntities:{},isAddingEntity:!1,isListToggled:!1,page:1,taskTypeId:"",sortedPlaylists:[],sortOptions:["updated_at","created_at","name"].map(i=>({label:i,value:i})),playlistToEdit:{name:`${n().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},previewFileMap:new Map,previewFileEntityMap:new Map,modals:{isBuildFilterDisplayed:!1,isDeleteDisplayed:!1,isEditDisplayed:!1},loading:{addPlaylist:!1,addDaily:!1,addEpisode:!1,addMovie:!1,addSequence:!1,addWeekly:!1,deletePlaylist:!1,editPlaylist:!1,playlist:!1,playlists:!1,playlistsInit:!0},errors:{addPlaylist:!1,editPlaylist:!1,deletePlaylist:!1,playlistLoading:!1}}},computed:{...b(["assetMap","assetSearchText","currentEpisode","currentProduction","displayedAssets","displayedAssetsByType","displayedSequences","displayedShots","displayedShotsBySequence","isAssetsLoading","isCurrentUserManager","isCurrentUserSupervisor","isShotsLoading","isTVShow","productionTaskTypes","playlistMap","playlists","playlistsPath","sequenceMap","shotsByEpisode","shotSearchText","shotMap","taskMap","taskStatusMap","taskTypeMap"]),isAdditionLoading(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily||this.loading.addEpisode},isAssetPlaylist(){return this.currentPlaylist.for_entity==="asset"},isSequencePlaylist(){return this.currentPlaylist.for_entity==="sequence"},currentEntityType(){return this.currentPlaylist.for_entity},isAddSearchVisible(){return this.isAssetPlaylist&&this.assetSearchText||!this.isAssetPlaylist&&this.shotSearchText},lastPlaylists(){return this.playlists},playlistPlayer(){return this.$refs["playlist-player"]},addEntitiesText(){return this.isAssetPlaylist?this.$t("playlists.add_assets"):this.isSequencePlaylist?this.$t("playlists.add_sequences"):this.$t("playlists.add_shots")},tvShowPageTitle(){const i=this.currentProduction?this.currentProduction.name:"";let t="";return this.currentEpisode&&(t=this.currentEpisode.name,this.currentEpisode.id==="all"&&(t=this.$t("main.all")),this.currentEpisode.id==="main"&&(t="Main Pack")),`${i} - ${t} | ${this.$t("playlists.title")} - Kitsu`},shortPageTitle(){return`${this.currentProduction?this.currentProduction.name:""} ${this.$t("playlists.title")} - Kitsu`},taskTypeList(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat([...this.productionTaskTypes])}},methods:{...T(["addNewBuildJob","pushEntityToPlaylist","changePlaylistOrder","changePlaylistPreview","changePlaylistType","displayMoreAssets","displayMoreShots","editPlaylist","getPending","loadMorePlaylists","loadPlaylist","loadPlaylists","loadEntityPreviewFiles","loadShots","loadAssets","markBuildJobAsDone","newPlaylist","refreshPlaylist","removeEntityPreviewFromPlaylist","removeBuildJobFromList","resetSequences","setAssetSearch","setCurrentEpisode","setSequenceSearch","setShotSearch","updatePreviewAnnotation"]),formatDate(i){return k(i)},getPlaylistPath(i,t){return C(this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,i,t)},playlistElementStyle(i){if(this.isListToggled)return;const t=this.taskTypeMap.get(i.task_type_id);return{"border-left":`4px solid ${(t==null?void 0:t.color)||"transparent"}`}},getTaskStatus(i){let t=this.shotMap.get(i.id);if(t||(t=this.assetMap.get(i.id)),t||(t=this.sequenceMap.get(i.id)),!t)return{};const s=i.validations.get(this.currentPlaylist.task_type_id);if(s){const e=this.taskMap.get(s);return e?this.taskStatusMap.get(e.task_status_id):{}}else return{}},loadShotsData(i){this.displayedShots.length===0||this.displayedShots[0].project_id!==this.currentProduction.id||this.currentEpisode&&this.displayedShots[0].episode_id!==this.currentEpisode.id?this.isTVShow&&this.currentEpisode&&(this.currentEpisode.id==="main"||this.currentEpisode.id==="all")?i():this.loadShots(i):i()},loadAssetsData(){return this.isTVShow||this.displayedAssets.length===0?this.loadAssets():Promise.resolve()},loadPlaylistsData(i=!1){const t=()=>{this.setCurrentPlaylist(()=>((!this.currentPlaylist||!this.currentPlaylist.id)&&this.goFirstPlaylist(),Promise.resolve()))};return this.playlists.length===0||i?this.loadPlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(()=>t()).catch(s=>(console.error(s),this.errors.loadPlaylists=!0,Promise.reject(s))):t()},onPlaylistListScroll(i,t){if(this.$options.silentMore)return;const s=this.$refs.playlistList;s.scrollHeight-s.offsetHeight<t.scrollTop+20&&(this.$options.silentMore=!0,this.page++,this.loadMorePlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(a=>{setTimeout(()=>{this.$options.silentMore=!1},1e3)}).catch(a=>(console.error(a),this.$options.silentMore=!1,this.errors.loadPlaylists=!0,Promise.reject(a))))},rebuildCurrentEntities(){this.currentEntities={};const i={};this.previewFileMap=new Map,this.previewFileEntityMap=new Map,this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach(t=>{const s=this.convertEntityToPlaylistFormat(t);s&&(i[s.id]=s,this.previewFileEntityMap.set(t.preview_file_id,s),Object.values(s.preview_files).forEach(a=>{a.forEach(l=>{this.previewFileMap.set(l.id,l)})}))}),this.$nextTick(()=>{this.currentEntities=i})},onAnnotationsRefreshed(i){const t=this.previewFileEntityMap.get(i.id),s=this.previewFileMap.get(i.id);t&&(t.preview_file_annotations=i.annotations),s&&(s.annotations=i.annotations)},convertEntityToPlaylistFormat(i){let t;if(this.isAssetPlaylist?t=this.assetMap.get(i.id):this.isSequencePlaylist?(t=this.sequenceMap.get(i.id),this.currentEpisode&&(t.episode_name=this.currentEpisode.name)):t=this.shotMap.get(i.id),t){const s={id:i.id,name:t.name,parent_name:t.sequence_name||t.episode_name||t.asset_type_name,preview_files:i.preview_files,preview_file_id:i.preview_file_id||t.preview_file_id,preview_file_extension:i.preview_file_extension||t.preview_file_extension,preview_file_revision:i.preview_file_revision||t.preview_file_revision,preview_file_width:i.preview_file_width||t.preview_file_width,preview_file_height:i.preview_file_height||t.preview_file_height,preview_file_duration:i.preview_file_duration||t.preview_file_duration,preview_file_task_id:i.task_id||i.preview_file_task_id||t.preview_file_task_id,preview_file_annotations:i.preview_file_annotations||t.preview_file_annotations,preview_file_previews:i.preview_file_previews||t.preview_file_previews,preview_nb_frames:i.nb_frames||t.nb_frames||x};return this.previewFileEntityMap.set(s.preview_file_id,s),(s.preview_file_previews||[]).forEach(a=>{this.previewFileMap.set(a.id,a)}),s}else return null},setCurrentPlaylist(i){const t=this.$route.params.playlist_id,s=this.playlistMap.get(t);s?(this.loading.playlist=!0,this.loadPlaylist({playlist:s,callback:(e,a)=>{e&&console.error(e),this.currentPlaylist=a,this.rebuildCurrentEntities(),this.loading.playlist=!1,i&&i()}})):(this.currentPlaylist={name:""},this.currentShots={})},addEntity(i,t=!0){return this.loadEntityPreviewFiles(i).then(s=>this.addToStorePlaylistAndSave(s,i)).then(s=>{this.addToPlayerPlaylist(s,t)}).catch(s=>console.error(s))},addToStorePlaylistAndSave(i,t){return this.pushEntityToPlaylist({playlist:this.currentPlaylist,previewFiles:i,entity:{...t}})},addToPlayerPlaylist(i,t=!0){const s=this.convertEntityToPlaylistFormat(i);M.set(this.currentEntities,s.id,s),this.playlistPlayer.entityList.push(s),t&&this.$nextTick(()=>{this.playlistPlayer.scrollToRight()})},addEntityToPlaylist(i){this.currentEntities[i.id]||this.addEntity(i).then(this.playlistPlayer.scrollToRight())},onNewEntityDropped(i){let t=null;this.isAssetPlaylist?t=this.assetMap.get(i.after):this.isSequencePlaylist?t=this.sequenceMap.get(i.after):t=this.shotMap.get(i.after),t&&!this.currentEntities[t.id]&&this.addEntity(t,!1).then(()=>{this.playlistPlayer.onEntityDropped(i)})},removeEntity(i){this.removeEntityPreviewFromPlaylist({playlist:this.currentPlaylist,entity:i,callback:()=>{delete this.currentEntities[i.id]}})},clearCurrentPlaylist(){this.currentPlaylist={},this.currentShots={}},resetPlaylist(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},addCurrentSelection(){this.$options.silent=!0;const i=this.isAssetPlaylist?this.displayedAssets:this.displayedShots;this.addEntities([...i].reverse(),()=>{this.$options.silent=!1})},addSequence(i){if(i.length>0){const t=i[0].sequence_id,s=Array.from(this.shotMap.values()).filter(e=>e.sequence_id===t).sort(o("name")).reverse();this.$options.silent=!0,this.addEntities(s,()=>{this.$options.silent=!1})}},addAllPending(){this.$options.silent=!0,this.loading.addWeekly=!0,this.getPending(!1).then(i=>{this.addEntities(i.reverse(),()=>{this.loading.addWeekly=!1,this.$options.silent=!1})})},addDailyPending(){this.loading.addDaily=!0,this.$options.silent=!0,this.getPending(!0).then(i=>{this.addEntities(d(i).reverse(),()=>{this.loading.addDaily=!1,this.$options.silent=!1})})},addEpisodePending(){this.loading.addEpisode=!0,this.$options.silent=!0;let i=[].concat(...this.shotsByEpisode);i=d(i).reverse(),this.addEntities(i,()=>{this.loading.addEpisode=!1,this.$options.silent=!1})},addMovie(){this.loading.addMovie=!0,this.$options.silent=!0;const i=d(Array.from(this.shotMap.values()));this.addEntities(i.reverse(),()=>{this.loading.addMovie=!1,this.$options.silent=!1})},addEntities(i,t){if(i&&i.length>0){const s=i.pop();this.addEntity(s).then(()=>{this.addEntities(i,t)})}else t()},onPreviewChanged(i,t){this.changePlaylistPreview({playlist:this.currentPlaylist,entity:i,previewFileId:t})},onOrderChange(i){this.changePlaylistOrder({playlist:this.currentPlaylist,info:i})},onAnnotationChanged({preview:i,additions:t,deletions:s,updates:e}){const a=i.task_id;this.updatePreviewAnnotation({taskId:a,preview:i,additions:t,deletions:s,updates:e})},confirmBuildFilter(i){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(i),this.onSearchChange(i)},onSearchChange(i){i.length>1?this.isAssetPlaylist?(this.setAssetSearch(i),this.displayMoreAssets()):this.isSequencePlaylist?(this.setSequenceSearch(i),this.resetSequences()):(this.setShotSearch(i),this.displayMoreShots()):this.isAssetPlaylist?this.setAssetSearch(""):this.isSequencePlaylist?this.setSequenceSearch(""):this.setShotSearch("")},onForClientChanged(i){this.editPlaylist({data:{id:this.currentPlaylist.id,for_client:i}})},runAddPlaylist(i){const t={name:i.name,production_id:this.currentProduction.id,for_client:i.for_client,for_entity:i.for_entity,is_for_all:i.is_for_all,task_type_id:i.task_type_id};this.isTVShow&&this.currentEpisode&&(t.episode_id=this.currentEpisode.id),this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.newPlaylist(t).then(s=>{this.$router.push(this.getPlaylistPath(s.id)),this.loading.editPlaylist=!1,this.modals.isEditDisplayed=!1}).catch(s=>{console.error(s),this.errors.editPlaylist=!0,this.loading.editPlaylist=!1})},confirmEditPlaylist(i){this.playlistToEdit.id?(i.id=this.currentPlaylist.id,this.runEditPlaylist(i)):this.runAddPlaylist(i)},runEditPlaylist(i){this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.editPlaylist({data:{id:i.id,for_client:i.for_client,for_entity:i.for_entity,name:i.name,task_type_id:i.task_type_id},callback:(t,s)=>{t?this.errors.editPlaylist=!0:(this.modals.isEditDisplayed=!1,Object.assign(this.currentPlaylist,s)),this.loading.editPlaylist=!1}})},goFirstPlaylist(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},toggleAddEntities(){this.isAddingEntity&&this.resetPlaylist(),this.isAddingEntity=!this.isAddingEntity},onTaskTypeChanged(i){this.changePlaylistType({playlist:this.currentPlaylist,taskTypeId:i,callback:()=>{this.rebuildCurrentEntities()}})},onBodyScroll(i,t){this.$refs.entityListContent.scrollHeight-this.$refs.entityListContent.offsetHeight<t.scrollTop&&(this.isAssetPlaylist?this.displayMoreAssets():this.displayMoreShots())},resetSorting(){let i=1;["created_at","updated_at"].includes(this.currentSort)&&(i=-1),this.sortedPlaylists=[...this.playlists].sort(o(this.currentSort,i).thenBy("name"))},showAddModal(){this.playlistToEdit={name:`${n().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},showEditModal(){this.playlistToEdit=this.currentPlaylist,this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},hideEditModal(){this.playlistToEdit={name:`${n().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.modals.isEditDisplayed=!1},reloadAll(){this.loading.playlists||(this.loading.playlists=!0,this.loadShotsData(()=>{this.loadAssetsData().then(()=>(this.page=1,this.loadPlaylistsData())).then(()=>{this.loading.playlists=!1,this.resetPlaylist(),setTimeout(()=>{this.loading.playlistsInit=!1},300)})}))}},mounted(){this.$nextTick(()=>{this.reloadAll(),localStorage.getItem("playlist-sort")&&(this.currentSort=localStorage.getItem("playlist-sort")),this.resetSorting()})},watch:{$route(){this.setCurrentPlaylist()},currentPlaylist(){this.currentPlaylist.shots?(this.$options.silentMore=!1,this.isAddingEntity=Object.keys(this.currentPlaylist.shots).length===0):this.isAddingEntity=!0},currentProduction(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.reloadAll()},currentEpisode(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.currentEpisode&&this.reloadAll()},playlists(){},currentSort(){localStorage.setItem("playlist-sort",this.currentSort),this.loading.playlists=!0,this.page=1,this.loadPlaylistsData(!0).then(()=>{this.loading.playlists=!1})},isListToggled(){var i;(i=this.playlistPlayer)==null||i.onWindowResize()},taskTypeId(){this.loadPlaylistsData(!0)}},socket:{events:{"playlist:new"(i){this.playlistMap.get(i.playlist_id)||this.refreshPlaylist(i.playlist_id)},"playlist:update"(i){},"playlist:delete"(i){this.$store.commit("DELETE_PLAYLIST_END",{id:i.playlist_id})},"build-job:new"(i){i.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:i.build_job_id,created_at:i.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update"(i){i.playlist_id===this.currentPlaylist.id&&A(this.currentPlaylist.build_jobs,{id:i.build_job_id,status:i.status})},"build-job:delete"(i){i.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=$(this.currentPlaylist.build_jobs,{id:i.build_job_id}))}}},metaInfo(){return this.isTVShow?{title:this.tvShowPageTitle}:{title:this.shortPageTitle}}};var N=function(){var t=this,s=t._self._c;return s("div",{staticClass:"playlists page fixed-page dark"},[s("div",{staticClass:"columns"},[s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onPlaylistListScroll,expression:"onPlaylistListScroll"}],ref:"playlistList",class:{"playlist-list-column":!0,column:!0,toggled:t.isListToggled}},[s("div",{staticClass:"flexrow top-section"},[t.isListToggled?t._e():s("combobox-task-type",{staticClass:"flexrow-item selector mb1",attrs:{"task-type-list":t.taskTypeList,label:t.$t("playlists.filter_task_type"),thin:!0},model:{value:t.taskTypeId,callback:function(e){t.taskTypeId=e},expression:"taskTypeId"}}),t.isListToggled?t._e():s("span",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",staticStyle:{flex:"0"},attrs:{icon:t.isListToggled?"right":"left","is-small":""},on:{click:function(e){t.isListToggled=!t.isListToggled}}})],1),s("div",{staticClass:"flexrow"},[t.isListToggled?t._e():[s("combobox",{staticClass:"flexrow-item mb2",attrs:{label:t.$t("main.sorted_by"),options:t.sortOptions,"locale-key-prefix":"playlists.fields."},model:{value:t.currentSort,callback:function(e){t.currentSort=e},expression:"currentSort"}})]],2),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&!t.isListToggled?s("button",{key:"new-playlist-button",class:{button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.showAddModal}},[s("plus-icon",{staticClass:"icon is-small"}),t._v(" "+t._s(t.$t("playlists.new_playlist"))+" ")],1):t._e(),t.loading.playlists?s("spinner",{staticClass:"mt2"}):s("div",{staticClass:"playlists"},t._l(t.playlists,function(e){return s("router-link",{key:e.id,class:{"playlist-item":!0,"for-client":e.for_client||!1,selected:e.id===t.currentPlaylist.id},attrs:{to:t.getPlaylistPath(e.id)}},[s("div",{staticClass:"playlist-item-content",style:t.playlistElementStyle(e)},[t.isListToggled?s("div",{staticClass:"has-text-centered"},[e.first_preview_file_id?s("light-entity-thumbnail",{attrs:{"preview-file-id":e.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:e.name}}):t._e()],1):s("div",{staticClass:"flexrow"},[s("light-entity-thumbnail",{staticClass:"flerxow-item playlist-thumbnail",attrs:{"preview-file-id":e.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:e.name,"with-link":"false"}}),s("div",{staticClass:"flerxow-item ml05"},[t._v(" "+t._s(e.name)+" "),s("span",{staticClass:"playlist-date"},[t._v(" "+t._s(t.$t("playlists.updated_at"))+" "+t._s(t.formatDate(e.updated_at))+" ")])])],1)])])}),1),t.errors.playlistLoading?s("error-text",{attrs:{text:t.$t("playlists.loading_error")}}):t._e()],1),t.playlists.length>0&&!t.currentPlaylist.id&&!t.loading.playlist?s("div",{staticClass:"playlist-column no-selection"},[!t.loading.playlists&&!t.loading.playlistsInit?s("div",{staticClass:"flexcolumn xyz-in",attrs:{xyz:"fade stagger"}},t._l(t.lastPlaylists,function(e){return s("router-link",{key:"recent-playlist-"+e.id,staticClass:"recent-playlist flexrow-item flexrow",attrs:{to:t.getPlaylistPath(e.id)}},[s("div",{staticClass:"has-text-centered"},[s("light-entity-thumbnail",{staticClass:"playlist-thumbnail",attrs:{"preview-file-id":e.first_preview_file_id,type:"previews",width:"auto",height:"auto","empty-height":"252px"}})],1),s("div",{staticClass:"playlist-infos flexrow"},[s("div",[s("h3",[t._v(t._s(e.name))]),t.currentSort==="created_at"?s("span",[t._v(" "+t._s(t.$t("playlists.created_at"))+" "+t._s(t.formatDate(e.created_at))+" ")]):s("span",[t._v(" "+t._s(t.$t("playlists.updated_at"))+" "+t._s(t.formatDate(e.updated_at))+" ")])]),s("span",{staticClass:"filler"}),s("div",[e.task_type_id?s("task-type-name",{attrs:{"task-type":t.taskTypeMap.get(e.task_type_id)}}):t._e()],1)])])}),1):s("spinner",{staticClass:"mt2"})],1):t.playlists.length===0?s("div",{staticClass:"playlist-column no-selection has-text-centered"},[!t.loading.playlists&&!t.loading.playlistsInit?s("div",[s("p",{staticClass:"empty-explaination"},[t._v(" "+t._s(t.$t("playlists.no_playlist"))+" ")]),t.isCurrentUserManager||t.isCurrentUserSupervisor?s("button",{key:"new-playlist-button",class:{big:!0,button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.showAddModal}},[t._v(" "+t._s(t.$t("playlists.new_playlist"))+" ")]):t._e()]):s("spinner",{staticClass:"mt2"})],1):s("div",{staticClass:"playlist-column column"},[s("playlist-player",{ref:"playlist-player",attrs:{playlist:t.currentPlaylist,entities:t.currentEntities,"is-loading":t.loading.playlist,"is-adding-entity":t.isAddingEntity,"current-entity-type":t.currentEntityType},on:{"edit-clicked":t.showEditModal,"show-add-entities":t.toggleAddEntities,"preview-changed":t.onPreviewChanged,"task-type-changed":t.onTaskTypeChanged,"playlist-deleted":function(e){return t.$router.push(t.playlistsPath)},"remove-entity":t.removeEntity,"order-change":t.onOrderChange,"annotation-changed":t.onAnnotationChanged,"for-client-changed":t.onForClientChanged,"annotations-refreshed":t.onAnnotationsRefreshed,"new-entity-dropped":t.onNewEntityDropped}}),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&t.isAddingEntity&&!t.loading.playlist?s("div",[s("div",{staticClass:"addition-header"},[s("div",{staticClass:"flexrow"},[s("page-subtitle",{staticClass:"flexrow-item",attrs:{text:t.addEntitiesText}}),s("span",{staticClass:"filler"}),s("a",{staticClass:"close-button",on:{click:t.toggleAddEntities}},[s("x-icon")],1)],1),s("div",{staticClass:"flexrow"},[s("search-field",{ref:"search-field",staticClass:"flexrow-item",attrs:{"can-save":!1,placeholder:t.isAssetPlaylist?"chars mode=wfa":"ex: seq01 anim=wfa"},on:{change:t.onSearchChange}}),s("button-simple",{staticClass:"flexrow-item",attrs:{title:t.$t("entities.build_filter.title"),icon:"filter"},on:{click:function(e){t.modals.isBuildFilterDisplayed=!0}}}),t.isAddSearchVisible?s("button",{class:{button:!0,"flexrow-item":!0,"add-sequence":!0},attrs:{disabled:t.isAdditionLoading},on:{click:t.addCurrentSelection}},[t._v(" "+t._s(t.$t("playlists.add_selection"))+" ")]):t._e(),s("span",{staticClass:"filler"}),t.isAssetPlaylist?t._e():s("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addDaily},attrs:{disabled:t.isAdditionLoading},on:{click:t.addDailyPending}},[t._v(" "+t._s(t.$t("playlists.build_daily"))+" ")]),t.isTVShow&&!t.isAssetPlaylist&&!t.isSequencePlaylist?s("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addEpisode},attrs:{disabled:t.isAdditionLoading},on:{click:t.addEpisodePending}},[t._v(" "+t._s(t.$t("playlists.add_episode"))+" ")]):t.isAssetPlaylist?t._e():s("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addMovie},attrs:{disabled:t.isAdditionLoading},on:{click:t.addMovie}},[t._v(" "+t._s(t.$t("playlists.add_movie"))+" ")])],1)])]):t._e(),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&t.isAddingEntity?s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}],staticClass:"addition-section"},[t.isShotsLoading||t.isAssetsLoading?s("spinner",{key:"entity-loader",staticClass:"mt2"}):s("div",{ref:"entityListContent"},[t.isAssetPlaylist?s("div",t._l(t.displayedAssetsByType,function(e,a){return s("div",{key:"asset-type-"+a},[e.length>0?s("h2",{staticClass:"entity-group-title"},[t._v(" "+t._s(e[0].asset_type_name)+" ")]):t._e(),s("div",{staticClass:"addition-entities"},t._l(e.filter(l=>!l.canceled),function(l){return s("div",{key:l.id,class:{"addition-shot":!0,playlisted:t.currentEntities[l.id]!==void 0},on:{click:function(r){return r.preventDefault(),t.addEntityToPlaylist(l)}}},[s("light-entity-thumbnail",{attrs:{"preview-file-id":l.preview_file_id,width:"150px",height:"100px"}}),s("span",{staticClass:"playlisted-shot-name"},[t._v(t._s(l.name))])],1)}),0)])}),0):t.isSequencePlaylist?s("div",[s("div",{staticClass:"addition-entities"},t._l(t.displayedSequences.filter(e=>!e.canceled),function(e){return s("div",{key:e.id,class:{"addition-shot":!0,playlisted:t.currentEntities[e.id]!==void 0},on:{click:function(a){return a.preventDefault(),t.addEntityToPlaylist(e)}}},[s("light-entity-thumbnail",{attrs:{"preview-file-id":e.preview_file_id,width:"150px",height:"100px"}}),s("div",[t.currentPlaylist.task_type_id?s("span",{style:{color:t.getTaskStatus(e).color},attrs:{title:t.getTaskStatus(e).name}},[t._v(" • ")]):t._e(),s("span",{staticClass:"playlisted-shot-name"},[t._v(t._s(e.name))])])],1)}),0)]):s("div",t._l(t.displayedShotsBySequence,function(e,a){return s("div",{key:"sequence-"+a},[e.length>0?s("h2",{staticClass:"entity-group-title"},[t._v(" "+t._s(e[0].sequence_name)+" "),t.isCurrentUserManager||t.isCurrentUserSupervisor?s("button",{key:"add-sequence-button-"+e[0].sequence_id,staticClass:"button",on:{click:function(l){return t.addSequence(e)}}},[t._v(" "+t._s(t.$t("playlists.add_sequence"))+" ")]):t._e()]):t._e(),s("div",{staticClass:"addition-entities"},t._l(e.filter(l=>!l.canceled),function(l){return s("drag",{key:l.id,attrs:{"transfer-data":l.id}},[s("div",{class:{"addition-shot":!0,playlisted:t.currentEntities[l.id]!==void 0},attrs:{"transfer-data":l.id},on:{click:function(r){return r.preventDefault(),t.addEntityToPlaylist(l)}}},[s("light-entity-thumbnail",{attrs:{"preview-file-id":l.preview_file_id,width:"150px",height:"100px"}}),s("div",[t.currentPlaylist.task_type_id?s("span",{style:{color:t.getTaskStatus(l).color},attrs:{title:t.getTaskStatus(l).name}},[t._v(" • ")]):t._e(),s("span",{staticClass:"playlisted-shot-name"},[t._v(t._s(l.name))])])],1)])}),1)])}),0)])],1):t._e()],1)]),s("edit-playlist-modal",{ref:"edit-playlist-modal",attrs:{active:t.modals.isEditDisplayed,"is-loading":t.loading.editPlaylist,"is-error":t.errors.editPlaylist,"playlist-to-edit":t.playlistToEdit,"task-type-id":t.taskTypeId},on:{cancel:t.hideEditModal,confirm:t.confirmEditPlaylist}}),s("build-filter-modal",{ref:"build-filter-modal",attrs:{active:t.modals.isBuildFilterDisplayed,"entity-type":t.currentEntityType},on:{confirm:t.confirmBuildFilter,cancel:function(e){t.modals.isBuildFilterDisplayed=!1}}})],1)},Y=[],H=h(j,N,Y,!1,null,"15be4c0e",null,null);const I=H.exports;export{I as default};
//# sourceMappingURL=Playlist-DXgerv9w.js.map
