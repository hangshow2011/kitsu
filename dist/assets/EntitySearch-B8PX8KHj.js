import{ao as h,o as d,ap as u,a6 as m,aq as p,S as f,m as _,a as v,u as g,a8 as C,ar as x,n as I}from"./index-Djh35xFL.js";const c=[12,24,48],$={name:"entity-search",mixins:[],components:{Checkbox:h,Combobox:d,ComboboxProduction:u,EntityPreview:m,SearchIcon:p,Spinner:f},data(){return{isLoading:!1,isLoadingMoreAssets:!1,isLoadingMoreShots:!1,limit:c[0],limitOptions:c.map(e=>({label:e,value:e})),productionId:"",selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},props:{},mounted(){window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.altKey&&e.keyCode===70?this.searchField.focus():e.keyCode===40?this.selectNext():e.keyCode===38&&this.selectPrevious()}),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},computed:{..._(["openProductions","productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let e=[];return this.searchFilter.assets&&(e=e.concat(this.results.assets)),this.searchFilter.shots&&(e=e.concat(this.results.shots)),this.searchFilter.persons&&(e=e.concat(this.results.persons)),e},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots},productionList(){return[{id:"",name:this.$t("main.all")}].concat([...this.openProductions])}},methods:{...v(["searchData"]),search(){this.isLoading=!0;const e=Object.entries(this.searchFilter).map(([s,t])=>t?s:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,productionId:this.productionId,index_names:e}).then(s=>{delete s.persons,this.results=s}).catch(console.error).finally(()=>{this.isLoading=!1})},loadMoreResults(e){const s=[e],t=`isLoadingMore${g.capitalize(e)}`;this[t]=!0,this.searchData({query:this.searchQuery,limit:this.limit,offset:this.results[e].length,productionId:this.productionId,index_names:s}).then(a=>{this.results[e]=this.results[e].concat(a[e])}).catch(console.error).finally(()=>{this[t]=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`).scrollIntoView(!1)},selectResultById(e){this.selectedIndex=this.flattenResults.findIndex(s=>s.id===e)},onResultSelected(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`).click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(e,s){const a=this.productionMap.get(e.project_id).production_type==="tvshow";let r=null;return a&&(r=e.episode_id||"main"),C(e.id,e.project_id,s,r)},personPath(e){return x(e.id)},getMatchDetails(e){const s=e.matched_terms.join(", ");return this.$t("search.match_details",{target:s})}},watch:{productionId(){this.search()},searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},metaInfo(){return{title:`${this.$t("search.title")} - Kitsu`}}};var y=function(){var a,r,l,o;var s=this,t=s._self._c;return t("div",{staticClass:"entity-search page"},[t("form",{staticClass:"search-form",on:{submit:function(i){return i.preventDefault(),s.onResultSelected()}}},[t("div",[t("combobox-production",{staticClass:"flexrow-item production-field",attrs:{label:s.$t("main.production"),"production-list":s.productionList},model:{value:s.productionId,callback:function(i){s.productionId=i},expression:"productionId"}})],1),t("div",{staticClass:"search-field"},[t("span",{staticClass:"search-icon"},[t("search-icon",{attrs:{width:"20"}})],1),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:s.searchQuery,expression:"searchQuery",modifiers:{trim:!0}}],ref:"search-field",staticClass:"input",attrs:{placeholder:s.$t("search.placeholder")},domProps:{value:s.searchQuery},on:{input:function(i){i.target.composing||(s.searchQuery=i.target.value.trim())},blur:function(i){return s.$forceUpdate()}}})]),t("div",{staticClass:"search-options pa1 flexrow"},[t("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("assets.title")},on:{change:s.search},model:{value:s.searchFilter.assets,callback:function(i){s.$set(s.searchFilter,"assets",i)},expression:"searchFilter.assets"}}),t("checkbox",{staticClass:"flexrow-item",attrs:{toggle:!0,label:s.$t("shots.title")},on:{change:s.search},model:{value:s.searchFilter.shots,callback:function(i){s.$set(s.searchFilter,"shots",i)},expression:"searchFilter.shots"}}),t("div",{staticClass:"filler"}),t("span",{staticClass:"flexrow-item no-margin"},[s._v(" "+s._s(s.$t("search.limit"))+" ")]),t("combobox",{staticClass:"search-limit flexrow-item",attrs:{options:s.limitOptions,"with-margin":!1},on:{input:s.search},model:{value:s.limit,callback:function(i){s.limit=i},expression:"limit"}})],1)]),t("div",{staticClass:"search-results mb2"},[s.searchQuery.length<3?t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.type"))+" ")]):s.noSearchFilters?t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_filter"))+" ")]):s.isLoading?t("div",[t("spinner")],1):t("div",[this.searchFilter.assets?t("div",{staticClass:"pb1"},[t("h2",{staticClass:"mt0"},[s._v(" "+s._s(s.$t("assets.title"))+" ("+s._s(((a=this.results.assets)==null?void 0:a.length)||0)+") ")]),(r=this.results.assets)!=null&&r.length?t("div",{staticClass:"result-list"},s._l(this.results.assets,function(i){return t("div",{key:i.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===i},on:{mouseover:function(n){return s.selectResultById(i.id)}}},[t("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:i,"is-rounded-top-border":""}}),t("router-link",{staticClass:"result-description",attrs:{id:`result-link-${i.id}`,to:s.entityPath(i,"asset")}},[t("div",{staticClass:"production-name"},[s._v(" "+s._s(i.project_name)+" ")]),t("div",{staticClass:"entity-name"},[s._v(" "+s._s(i.asset_type_name)+" / "+s._s(i.name)+" ")]),t("div",{staticClass:"match"},[t("span",{staticClass:"match-icon"},[t("search-icon",{attrs:{width:"15"}})],1),s._v(" "+s._s(s.getMatchDetails(i))+" ")])])],1)}),0):t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")]),s.results.assets.length!==0&&s.results.assets.length%12===0?t("p",{staticClass:"has-text-centered mt2"},[s.isLoadingMoreAssets?t("spinner"):t("button",{staticClass:"button is-link",on:{click:function(i){return s.loadMoreResults("assets")}}},[s._v(" "+s._s(s.$t("main.load_more"))+" ")])],1):s._e()]):s._e(),this.searchFilter.shots?t("div",{staticClass:"pb1"},[t("h2",{staticClass:"mt1"},[s._v(" "+s._s(s.$t("shots.title"))+" ("+s._s(((l=this.results.shots)==null?void 0:l.length)||0)+") ")]),(o=this.results.shots)!=null&&o.length?t("div",{staticClass:"result-list"},s._l(this.results.shots,function(i){return t("div",{key:i.id,staticClass:"result flexcolumn",class:{"selected-result":s.flattenResults[s.selectedIndex]===i},on:{mouseover:function(n){return s.selectResultById(i.id)}}},[t("entity-preview",{attrs:{"empty-height":200,"empty-width":300,height:200,width:300,entity:i,"is-rounded-top-border":""}}),t("router-link",{staticClass:"result-description",attrs:{id:`result-link-${i.id}`,to:s.entityPath(i,"shot")}},[t("div",{staticClass:"production-name"},[s._v(" "+s._s(i.project_name)+" ")]),t("div",{staticClass:"entity-name"},[i.episode_name?[s._v(" "+s._s(i.episode_name)+" / ")]:s._e(),s._v(" "+s._s(i.sequence_name)+" / "+s._s(i.name)+" ")],2),t("div",{staticClass:"match"},[t("span",{staticClass:"match-icon"},[t("search-icon",{attrs:{width:"15"}})],1),t("span",{staticClass:"match-details"},[s._v(s._s(s.getMatchDetails(i)))])])])],1)}),0):t("div",{staticClass:"has-text-centered"},[s._v(" "+s._s(s.$t("main.search.no_result"))+" ")]),s.results.shots.length!==0&&s.results.shots.length%12===0?t("p",{staticClass:"has-text-centered mt2"},[s.isLoadingMoreShots?t("spinner"):t("button",{staticClass:"button is-link",on:{click:function(i){return s.loadMoreResults("shots")}}},[s._v(" "+s._s(s.$t("main.load_more"))+" ")])],1):s._e()]):s._e()])])])},b=[],w=I($,y,b,!1,null,"928d546a",null,null);const F=w.exports;export{F as default};
//# sourceMappingURL=EntitySearch-B8PX8KHj.js.map
